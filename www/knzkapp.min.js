function AccountCard(e,t){var o;return o="addList"===t?"addAccountToList('"+e.id+"')":"delList"===t?"addAccountToList('"+e.id+"', true)":"show_account('"+e.id+"')",e.action=o,e.display_name=t_text(escapeHTML(e.display_name),e.emojis,e.acct),tmpl("account_card_tmpl",e)}function show_account(t){loadNav("account.html",null),Fetch("https://"+inst+"/api/v1/accounts/"+t,{headers:{"content-type":"application/json",Authorization:"Bearer "+now_userconf.token},method:"GET"}).then(function(e){if(e.ok)return e.json();throw e}).then(function(e){acctdata.acct[e.id]=e,account_page_id=e.id,account_page_acct=e.acct;var t="",o=0;if(e.fields&&e.fields[0])for(;e.fields[o];)t+='<div class="account_bar account_bar_mode" '+(0===o?"style='border-top:none'":"")+'><div class="account_links"><span class="account_tab fields_left">'+escapeHTML(e.fields[o].name)+'</span><span class="account_tab acctTL_now fields_right">'+t_text(e.fields[o].value,e.emojis,e.acct)+"</span></div></div>",o++;if(elemId("bio_field").innerHTML=t,e.display_name||(e.display_name=e.username),elemId("userpage-name").innerHTML=t_text(escapeHTML(e.display_name),e.emojis,e.acct),elemId("userpage-title").innerHTML="@"+e.acct,elemId("userpage-acct").innerHTML="@"+e.acct,elemId("userpage-bio").innerHTML=t_text(e.note,e.emojis,e.acct),elemId("userpage-icon").src=e[getConfig(1,"no_gif")?"avatar_static":"avatar"],document.getElementById("userpage-bg").setAttribute("style","background-image: url('"+e[getConfig(1,"no_gif")?"header_static":"header"]+"');"),elemId("userpage-follow").innerHTML=e.following_count,elemId("userpage-follower").innerHTML=e.followers_count,elemId("userpage-post-count").innerHTML=e.statuses_count,e.locked?$("#userpage-lock").removeClass("invisible"):$("#userpage-lock").addClass("invisible"),e.bot?$("#userpage-bot").removeClass("invisible"):$("#userpage-bot").addClass("invisible"),showAccountTL(e.id),e.moved?(elemId("acct-moved-base").className="toot acct-small",elemId("acct-moved").innerHTML=AccountCard(e.moved)):elemId("acct-moved-base").className="invisible",e.username===e.acct){var n=new Date(e.created_at).toLocaleDateString(lng,{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});elemId("userpage-hint").innerHTML=i18next.t("account.joined_at")+": <b>"+n+"</b>"}else elemId("userpage-hint").innerHTML="<span class='note'>"+i18next.t("account.note")+"</span>"}).catch(function(e){catchHttpErr("show_account",e)}),Fetch("https://"+inst+"/api/v1/accounts/relationships?id="+t,{headers:{"content-type":"application/json",Authorization:"Bearer "+now_userconf.token},method:"GET"}).then(function(e){if(e.ok)return e.json();throw e}).then(function(e){acctdata.rs[t]=e,elemId("userpage-follower-badge").className=!0===e[0].followed_by?"userpage-follower":"invisible",elemId("userpage-follow-button").className="userpage-button ons-icon fa "+(e[0].following?"fa-user-times follow-active":"fa-user-plus"),e[0].muting&&(elemId("userpage-follow-button").className="invisible"),elemId("userpage-mute-badge").className=e[0].muting?"userpage-follower":"invisible",!0===e[0].blocking&&(elemId("userpage-follow-button").className="invisible"),elemId("userpage-block-badge").className=!0===e[0].blocking?"userpage-follower":"invisible",e[0].id===now_userconf.id&&(elemId("userpage-follow-button").className="invisible",elemId("userpage-follower-badge").className="invisible"),!0===e[0].requested&&(elemId("userpage-follow-button").className="userpage-button follow-active ons-icon fa-hourglass fa"),elemId("userpage-followreq-badge").className=!0===e[0].requested?"userpage-follower":"invisible"}).catch(function(e){catchHttpErr("relationships",e)})}function account_state_action(t,o){var e="";"follow"===o?(e=acctdata.rs[t][0].following||acctdata.rs[t][0].requested?"/unfollow":"/follow",elemId("userpage-follow-button").className="userpage-button ons-icon fa-spinner fa fa-spin"):"mute"===o?e=acctdata.rs[t][0].muting?"/unmute":"/mute":"block"===o&&(e=acctdata.rs[t][0].blocking?"/unblock":"/block"),Fetch("https://"+inst+"/api/v1/accounts/"+t+e,{headers:{"content-type":"application/json",Authorization:"Bearer "+now_userconf.token},method:"POST"}).then(function(e){if(e.ok)return e.json();throw e}).then(function(e){"follow"!==o&&showtoast("ok_conf_2"),setTimeout(function(){show_account(t)},500)}).catch(function(e){catchHttpErr("state_action",e)})}function account_action(t){if(now_userconf.id==t)ons.openActionSheet({cancelable:!0,buttons:[i18next.t("actionsheet.toot.openbrowser"),i18next.t("actionsheet.toot.url"),i18next.t("actionsheet.toot.qrcode"),{label:i18next.t("navigation.cancel"),icon:"md-close"}]}).then(function(e){0===e?openURL(acctdata.acct[t].url):1===e?copy(acctdata.acct[t].url):2===e&&OpenQR("@"+account_page_acct.split("@")[0]+"@"+inst)});else{var e=acctdata.rs[t][0].muting?i18next.t("actionsheet.toot.mute.unset"):i18next.t("actionsheet.toot.mute.set"),o=acctdata.rs[t][0].blocking?i18next.t("actionsheet.toot.block.unset"):i18next.t("actionsheet.toot.block.set");ons.openActionSheet({cancelable:!0,buttons:[i18next.t("actionsheet.toot.mention"),i18next.t("actionsheet.toot.openbrowser"),i18next.t("actionsheet.toot.url"),{label:e,modifier:"destructive"},{label:o,modifier:"destructive"},{label:i18next.t("navigation.cancel"),icon:"md-close"}]}).then(function(e){0===e?post_pre("@"+account_page_acct):1===e?openURL(acctdata.acct[t].url):2===e?copy(acctdata.acct[t].url):3===e?account_state_action(t,"mute"):4===e&&account_state_action(t,"block")})}}function show_account_name(n){Fetch("https://"+inst+"/api/v1/search?q="+n,{headers:{"content-type":"application/json",Authorization:"Bearer "+now_userconf.token},method:"GET"}).then(function(e){if(e.ok)return e.json();throw e}).then(function(e){if(e){var t=e.accounts[0];if(!t)return showtoast("cannot-pros"),!1;var o=n.toLowerCase();!1+t.acct.toLowerCase()===o&&!("@"+t.acct+"@"+inst).toLowerCase()===o&&showtoast("no-acct"),show_account(t.id)}}).catch(function(e){catchHttpErr("show_account_username",e)})}function post_pre(e,t){tmp_text_pre=t?e:e+" ",loadNav("post.html","up")}function OpenQR(e){document.querySelector("#navigator").bringPageTop("qrcode.html").then(function(){elemId("qrimg").src="http://chart.googleapis.com/chart?cht=qr&chs=200x200&choe=UTF-8&chl=https%3A%2F%2Fopenapp.nzws.me%2Fopen.html%3F"+encodeURIComponent(e),elemId("qr-userid").innerText=e})}function update_userdata(){Fetch("https://"+inst+"/api/v1/accounts/update_credentials",{headers:{"content-type":"application/json",Authorization:"Bearer "+now_userconf.token},method:"PATCH",body:JSON.stringify({display_name:elemId("userconf-display_name").value,note:elemId("userconf-note").value,locked:elemId("userconf-lock").checked})}).then(function(e){if(e.ok)return e.json();throw e}).then(function(e){showtoast("ok_conf"),BackTab()}).catch(function(e){catchHttpErr("update_userdata",e)})}